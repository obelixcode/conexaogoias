<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popular Firebase - Conex√£o Goi√°s</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #3B82F6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563EB;
        }
        button:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
        }
        .success { background: #D1FAE5; color: #065F46; }
        .error { background: #FEE2E2; color: #991B1B; }
        .info { background: #DBEAFE; color: #1E40AF; }
        .log {
            background: #F3F4F6;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Popular Firebase - Conex√£o Goi√°s</h1>
        <p>Este script ir√° criar dados de exemplo no Firebase para testar o sistema.</p>
        
        <div class="status info">
            ‚ö†Ô∏è <strong>Importante:</strong> Certifique-se de que as regras do Firestore permitem escrita temporariamente.
        </div>
        
        <div>
            <button onclick="createCategories()" id="btnCategories">Criar Categorias</button>
            <button onclick="createNews()" id="btnNews" disabled>Criar Not√≠cias</button>
            <button onclick="clearAll()" id="btnClear">Limpar Tudo</button>
        </div>
        
        <div id="status"></div>
        <div id="log" class="log"></div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configura√ß√£o do Firebase (substitua pela sua)
        const firebaseConfig = {
            apiKey: "AIzaSyBvQZvQZvQZvQZvQZvQZvQZvQZvQZvQZvQ",
            authDomain: "aconexaogoias.firebaseapp.com",
            projectId: "aconexaogoias",
            storageBucket: "aconexaogoias.appspot.com",
            messagingSenderId: "6509088743",
            appId: "1:6509088743:web:1234567890abcdef"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let categories = [];

        const sampleCategories = [
            {
                name: 'Pol√≠tica',
                slug: 'politica',
                description: 'Not√≠cias sobre pol√≠tica local e nacional',
                color: '#3B82F6',
                order: 1,
                isActive: true
            },
            {
                name: 'Esportes',
                slug: 'esportes',
                description: 'Not√≠cias esportivas e eventos',
                color: '#10B981',
                order: 2,
                isActive: true
            },
            {
                name: 'Tecnologia',
                slug: 'tecnologia',
                description: 'Inova√ß√µes e novidades tecnol√≥gicas',
                color: '#8B5CF6',
                order: 3,
                isActive: true
            },
            {
                name: 'Economia',
                slug: 'economia',
                description: 'Not√≠cias econ√¥micas e financeiras',
                color: '#F59E0B',
                order: 4,
                isActive: true
            },
            {
                name: 'Cultura',
                slug: 'cultura',
                description: 'Eventos culturais e entretenimento',
                color: '#EF4444',
                order: 5,
                isActive: true
            }
        ];

        const sampleNews = [
            {
                title: 'Nova pol√≠tica de transporte p√∫blico √© aprovada',
                subtitle: 'Medida visa melhorar a mobilidade urbana na cidade',
                content: 'A nova pol√≠tica de transporte p√∫blico foi aprovada por unanimidade na c√¢mara municipal. A medida inclui investimentos em infraestrutura, renova√ß√£o da frota e melhorias na acessibilidade. O projeto tem previs√£o de implementa√ß√£o para o pr√≥ximo semestre.',
                tags: 'transporte, pol√≠tica, mobilidade',
                coverImageUrl: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=800&h=400&fit=crop',
                isPublished: true,
                isFeatured: true,
                views: 0,
                authorId: 'admin',
                authorName: 'Administrador'
            },
            {
                title: 'Time local vence campeonato estadual',
                subtitle: 'Vit√≥ria hist√≥rica garante vaga na pr√≥xima fase',
                content: 'O time local conquistou uma vit√≥ria hist√≥rica no campeonato estadual, garantindo vaga na pr√≥xima fase da competi√ß√£o. A partida foi decidida nos √∫ltimos minutos com um gol de falta. Os torcedores comemoraram nas ruas da cidade.',
                tags: 'futebol, esporte, campeonato',
                coverImageUrl: 'https://images.unsplash.com/photo-1431324155629-1a6deb1dec8d?w=800&h=400&fit=crop',
                isPublished: true,
                isFeatured: false,
                views: 0,
                authorId: 'admin',
                authorName: 'Administrador'
            }
        ];

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function setStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }

        window.createCategories = async function() {
            try {
                setStatus('üîÑ Criando categorias...', 'info');
                log('Iniciando cria√ß√£o de categorias...');
                
                const btn = document.getElementById('btnCategories');
                btn.disabled = true;
                
                for (const categoryData of sampleCategories) {
                    const docRef = await addDoc(collection(db, 'categories'), {
                        ...categoryData,
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    });
                    categories.push({ id: docRef.id, ...categoryData });
                    log(`‚úÖ Categoria "${categoryData.name}" criada com ID: ${docRef.id}`);
                }
                
                setStatus('‚úÖ Categorias criadas com sucesso!', 'success');
                document.getElementById('btnNews').disabled = false;
                log('üéâ Todas as categorias foram criadas!');
                
            } catch (error) {
                setStatus('‚ùå Erro ao criar categorias: ' + error.message, 'error');
                log('‚ùå Erro: ' + error.message);
            } finally {
                document.getElementById('btnCategories').disabled = false;
            }
        };

        window.createNews = async function() {
            try {
                if (categories.length === 0) {
                    setStatus('‚ö†Ô∏è Crie as categorias primeiro!', 'error');
                    return;
                }
                
                setStatus('üîÑ Criando not√≠cias...', 'info');
                log('Iniciando cria√ß√£o de not√≠cias...');
                
                const btn = document.getElementById('btnNews');
                btn.disabled = true;
                
                for (const newsData of sampleNews) {
                    const newsWithCategory = {
                        ...newsData,
                        categoryId: categories[0].id, // Usa a primeira categoria
                        publishedAt: serverTimestamp(),
                        createdAt: serverTimestamp(),
                        updatedAt: serverTimestamp()
                    };
                    
                    const docRef = await addDoc(collection(db, 'news'), newsWithCategory);
                    log(`‚úÖ Not√≠cia "${newsData.title}" criada com ID: ${docRef.id}`);
                }
                
                setStatus('‚úÖ Not√≠cias criadas com sucesso!', 'success');
                log('üéâ Todas as not√≠cias foram criadas!');
                
            } catch (error) {
                setStatus('‚ùå Erro ao criar not√≠cias: ' + error.message, 'error');
                log('‚ùå Erro: ' + error.message);
            } finally {
                document.getElementById('btnNews').disabled = false;
            }
        };

        window.clearAll = async function() {
            try {
                setStatus('üîÑ Limpando dados...', 'info');
                log('Iniciando limpeza...');
                
                // Limpar not√≠cias
                const newsSnapshot = await getDocs(collection(db, 'news'));
                for (const docSnapshot of newsSnapshot.docs) {
                    await deleteDoc(doc(db, 'news', docSnapshot.id));
                    log(`üóëÔ∏è Not√≠cia removida: ${docSnapshot.id}`);
                }
                
                // Limpar categorias
                const categoriesSnapshot = await getDocs(collection(db, 'categories'));
                for (const docSnapshot of categoriesSnapshot.docs) {
                    await deleteDoc(doc(db, 'categories', docSnapshot.id));
                    log(`üóëÔ∏è Categoria removida: ${docSnapshot.id}`);
                }
                
                categories = [];
                setStatus('‚úÖ Dados limpos com sucesso!', 'success');
                document.getElementById('btnNews').disabled = true;
                log('üéâ Limpeza conclu√≠da!');
                
            } catch (error) {
                setStatus('‚ùå Erro ao limpar dados: ' + error.message, 'error');
                log('‚ùå Erro: ' + error.message);
            }
        };

        // Carregar categorias existentes
        window.addEventListener('load', async () => {
            try {
                const categoriesSnapshot = await getDocs(collection(db, 'categories'));
                categories = categoriesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                if (categories.length > 0) {
                    setStatus(`üìã ${categories.length} categorias encontradas`, 'info');
                    document.getElementById('btnNews').disabled = false;
                }
            } catch (error) {
                log('‚ö†Ô∏è Erro ao carregar categorias: ' + error.message);
            }
        });
    </script>
</body>
</html>

"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3554],{3998:(e,t,a)=>{a.d(t,{$:()=>l});var r=a(95155);a(12115);var n=a(32467),o=a(83101),s=a(64269);let i=(0,o.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:a,size:o,asChild:l=!1,...c}=e,d=l?n.DX:"button";return(0,r.jsx)(d,{"data-slot":"button",className:(0,s.cn)(i({variant:a,size:o,className:t})),...c})}},37168:(e,t,a)=>{a.d(t,{n:()=>o});var r=a(79996),n=a(14585);class o{static async uploadImage(e,t,a){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;if(!n.IG)return console.warn("Firebase Storage not available, using fallback URL"),this.getFallbackImageUrl(e);try{if(!(0,r.KR)(n.IG,"test"))throw Error("Storage not properly initialized")}catch(t){return console.warn("Firebase Storage not properly configured, using fallback URL:",t),this.getFallbackImageUrl(e)}let s=null;for(let i=1;i<=o;i++)try{let o=await this.compressImage(e),l=(0,r.KR)(n.IG,t);if(!l)throw Error("Storage reference could not be created");if(a){let e=(0,r.bp)(l,o);return new Promise((t,n)=>{e.on("state_changed",e=>{let t=e.bytesTransferred/e.totalBytes*100;a(t)},e=>{console.error("Upload attempt ".concat(i," failed:"),e),s=e,n(e)},async()=>{try{let a=await (0,r.qk)(e.snapshot.ref);t(a)}catch(e){console.error("Get download URL attempt ".concat(i," failed:"),e),s=e,n(e)}})})}{let e=await (0,r.D)(l,o),a=await (0,r.qk)(e.ref);console.log("Upload successful:",{path:t,downloadURL:a});try{let e=await fetch(a,{method:"HEAD"});if(!e.ok)throw console.warn("Uploaded file not accessible:",e.status),Error("File not accessible: ".concat(e.status));console.log("File accessibility test passed")}catch(e){throw console.warn("File accessibility test failed:",e),Error("Uploaded file is not accessible")}return a}}catch(a){if(s=a,console.error("Upload attempt ".concat(i," failed:"),a),a instanceof Error&&a.message.includes("permission"))return console.warn("Permission denied, using fallback URL"),this.getFallbackImageUrl(e);if(i===o)break;let t=1e3*Math.pow(2,i);await new Promise(e=>setTimeout(e,t))}return console.error("All upload attempts failed, using fallback:",s),this.getFallbackImageUrl(e)}static getFallbackImageUrl(e){return"https://placehold.co/800x400/3B82F6/FFFFFF/png?text=".concat(encodeURIComponent(e.name))}static async testStorageConnection(){try{if(!n.IG)return console.error("Firebase Storage not initialized"),!1;if(!(0,r.KR)(n.IG,"test-connection"))return console.error("Could not create storage reference"),!1;return console.log("Firebase Storage connection test successful"),!0}catch(e){return console.error("Firebase Storage connection test failed:",e),!1}}static async uploadCoverImage(e,t,a){let r=Date.now(),n="cover-".concat(t,"-").concat(r,".").concat(e.name.split(".").pop());return this.uploadImage(e,"covers/".concat(n),a)}static async uploadContentImage(e,t){let a=Date.now(),r="content-".concat(a,".").concat(e.name.split(".").pop());return this.uploadImage(e,"content/".concat(r),t)}static async uploadBannerImage(e,t,a){let r=Date.now(),n=Math.random().toString(36).substring(2,8),o="banner-temp-".concat(r,"-").concat(n,".").concat(e.name.split(".").pop()),s="banners/".concat(o);console.log("Uploading banner image:",{fileName:o,path:s});try{let t=await this.uploadImage(e,s,a);return console.log("Banner upload completed:",t),t}catch(t){return console.error("Banner upload failed:",t),this.getFallbackImageUrl(e)}}static async deleteImage(e){try{let t=(0,r.KR)(n.IG,e);await (0,r.XR)(t)}catch(e){console.error("Delete image error:",e)}}static async compressImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1920,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(r=>{let n=document.createElement("canvas"),o=n.getContext("2d"),s=new Image;s.onload=()=>{let{width:i,height:l}=s;i>t&&(l=l*t/i,i=t),n.width=i,n.height=l,null==o||o.drawImage(s,0,0,i,l),n.toBlob(t=>{t?r(new File([t],e.name,{type:e.type,lastModified:Date.now()})):r(e)},e.type,a)},s.src=URL.createObjectURL(e)})}static getFileSizeMB(e){return e.size/1048576}static validateImageFile(e){return["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?this.getFileSizeMB(e)>5?{isValid:!1,error:"Arquivo muito grande. M\xe1ximo ".concat(5,"MB.")}:{isValid:!0}:{isValid:!1,error:"Tipo de arquivo n\xe3o suportado. Use JPG, PNG ou WebP."}}static generateUniqueFilename(e,t){let a=Date.now(),r=Math.random().toString(36).substring(2,8),n=e.split(".").pop(),o=e.split(".").slice(0,-1).join(".").toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").trim();return"".concat(t?"".concat(t,"-"):"").concat(o,"-").concat(a,"-").concat(r,".").concat(n)}static extractPathFromUrl(e){try{let t=new URL(e).pathname.match(/\/o\/(.+)\?/);return t?decodeURIComponent(t[1]):null}catch(e){return null}}static async cleanupOrphanedImages(e){try{let t=e.map(e=>this.deleteImage(e));await Promise.all(t)}catch(e){throw console.error("Cleanup orphaned images error:",e),Error("Erro ao limpar imagens \xf3rf\xe3s")}}}},63554:(e,t,a)=>{a.d(t,{G:()=>u});var r=a(95155),n=a(12115),o=a(15239),s=a(65229),i=a(5917),l=a(21786),c=a(3998),d=a(37168);function u(e){let{onImageUploaded:t,currentImage:a,className:u="",aspectRatio:g="video"}=e,[m,p]=(0,n.useState)(!1),[h,v]=(0,n.useState)(0),[b,f]=(0,n.useState)(a||null),x=(0,n.useRef)(null),w=async e=>{let a=d.n.validateImageFile(e);if(!a.isValid)return void alert(a.error);let r=URL.createObjectURL(e);f(r),p(!0),v(0);try{let a=await d.n.uploadBannerImage(e,"temp-".concat(Date.now()),e=>{v(e)});t(a),URL.revokeObjectURL(r)}catch(e){console.error("Error uploading image:",e),alert("Erro ao fazer upload da imagem"),f(null)}finally{p(!1),v(0)}};return(0,r.jsxs)("div",{className:"space-y-4 ".concat(u),children:[(0,r.jsxs)("div",{className:"\n          relative border-2 border-dashed border-gray-300 rounded-lg p-6 text-center\n          hover:border-gray-400 transition-colors cursor-pointer\n          ".concat({square:"aspect-square",video:"aspect-video",banner:"aspect-[16/9]"}[g],"\n          ").concat(m?"pointer-events-none":"","\n        "),onDrop:e=>{e.preventDefault();let t=e.dataTransfer.files[0];t&&t.type.startsWith("image/")&&w(t)},onDragOver:e=>{e.preventDefault()},onClick:()=>{var e;return null==(e=x.current)?void 0:e.click()},children:[(0,r.jsx)("input",{ref:x,type:"file",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&w(a)},className:"hidden","aria-label":"Upload de imagem"}),b?(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)(o.default,{src:b,alt:"Preview",fill:!0,className:"object-cover rounded-lg",sizes:"(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"}),m&&(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg",children:(0,r.jsxs)("div",{className:"text-white text-center",children:[(0,r.jsx)("div",{className:"text-sm mb-2",children:"Fazendo upload..."}),(0,r.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"progress-bar",style:{"--progress":"".concat(h,"%")}})}),(0,r.jsxs)("div",{className:"text-xs mt-1",children:[Math.round(h),"%"]})]})}),!m&&(0,r.jsx)(c.$,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:e=>{try{e.stopPropagation();try{f(null),t(""),x.current&&(x.current.value="")}catch(e){console.warn("Error removing image:",e)}}catch(e){console.warn("Error removing image:",e)}},children:(0,r.jsx)(s.A,{className:"h-4 w-4"})}),!m&&0===h&&b!==a&&(0,r.jsx)("div",{className:"absolute top-2 left-2",children:(0,r.jsx)("div",{className:"bg-green-500 text-white rounded-full p-1",children:(0,r.jsx)(i.A,{className:"h-4 w-4"})})})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,r.jsx)(l.A,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,r.jsx)("div",{className:"text-lg font-medium text-gray-900 mb-2",children:m?"Fazendo upload...":"Clique ou arraste uma imagem aqui"}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"PNG, JPG, WebP at\xe9 5MB"}),m&&(0,r.jsxs)("div",{className:"mt-4 w-full max-w-xs",children:[(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"progress-bar",style:{"--progress":"".concat(h,"%")}})}),(0,r.jsxs)("div",{className:"text-xs text-gray-600 mt-1 text-center",children:[Math.round(h),"%"]})]})]})]}),b&&!m&&(0,r.jsx)("div",{className:"text-sm text-gray-600 text-center",children:"Imagem carregada com sucesso! Clique para alterar."})]})}}}]);
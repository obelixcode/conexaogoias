"use strict";exports.id=7820,exports.ids=[7820],exports.modules={3200:(a,b,c)=>{c.d(b,{n:()=>f});var d=c(69477),e=c(13737);class f{static async uploadImage(a,b,c,f=3){if(!e.IG)return console.warn("Firebase Storage not available, using fallback URL"),this.getFallbackImageUrl(a);try{if(!(0,d.KR)(e.IG,"test"))throw Error("Storage not properly initialized")}catch(b){return console.warn("Firebase Storage not properly configured, using fallback URL:",b),this.getFallbackImageUrl(a)}let g=null;for(let h=1;h<=f;h++)try{let f=await this.compressImage(a),i=(0,d.KR)(e.IG,b);if(!i)throw Error("Storage reference could not be created");if(c){let a=(0,d.bp)(i,f);return new Promise((b,e)=>{a.on("state_changed",a=>{let b=a.bytesTransferred/a.totalBytes*100;c(b)},a=>{console.error(`Upload attempt ${h} failed:`,a),g=a,e(a)},async()=>{try{let c=await (0,d.qk)(a.snapshot.ref);b(c)}catch(a){console.error(`Get download URL attempt ${h} failed:`,a),g=a,e(a)}})})}{let a=await (0,d.D)(i,f),c=await (0,d.qk)(a.ref);console.log("Upload successful:",{path:b,downloadURL:c});try{let a=await fetch(c,{method:"HEAD"});if(!a.ok)throw console.warn("Uploaded file not accessible:",a.status),Error(`File not accessible: ${a.status}`);console.log("File accessibility test passed")}catch(a){throw console.warn("File accessibility test failed:",a),Error("Uploaded file is not accessible")}return c}}catch(c){if(g=c,console.error(`Upload attempt ${h} failed:`,c),c instanceof Error&&c.message.includes("permission"))return console.warn("Permission denied, using fallback URL"),this.getFallbackImageUrl(a);if(h===f)break;let b=1e3*Math.pow(2,h);await new Promise(a=>setTimeout(a,b))}return console.error("All upload attempts failed, using fallback:",g),this.getFallbackImageUrl(a)}static getFallbackImageUrl(a){return`https://placehold.co/800x400/3B82F6/FFFFFF/png?text=${encodeURIComponent(a.name)}`}static async testStorageConnection(){try{if(!e.IG)return console.error("Firebase Storage not initialized"),!1;if(!(0,d.KR)(e.IG,"test-connection"))return console.error("Could not create storage reference"),!1;return console.log("Firebase Storage connection test successful"),!0}catch(a){return console.error("Firebase Storage connection test failed:",a),!1}}static async uploadCoverImage(a,b,c){let d=Date.now(),e=`cover-${b}-${d}.${a.name.split(".").pop()}`,f=`covers/${e}`;return this.uploadImage(a,f,c)}static async uploadContentImage(a,b){let c=Date.now(),d=`content-${c}.${a.name.split(".").pop()}`,e=`content/${d}`;return this.uploadImage(a,e,b)}static async uploadBannerImage(a,b,c){let d=Date.now(),e=Math.random().toString(36).substring(2,8),f=`banner-temp-${d}-${e}.${a.name.split(".").pop()}`,g=`banners/${f}`;console.log("Uploading banner image:",{fileName:f,path:g});try{let b=await this.uploadImage(a,g,c);return console.log("Banner upload completed:",b),b}catch(b){return console.error("Banner upload failed:",b),this.getFallbackImageUrl(a)}}static async deleteImage(a){try{let b=(0,d.KR)(e.IG,a);await (0,d.XR)(b)}catch(a){console.error("Delete image error:",a)}}static async compressImage(a,b=1920,c=.8){return new Promise(d=>{let e=document.createElement("canvas"),f=e.getContext("2d"),g=new Image;g.onload=()=>{let{width:h,height:i}=g;h>b&&(i=i*b/h,h=b),e.width=h,e.height=i,f?.drawImage(g,0,0,h,i),e.toBlob(b=>{b?d(new File([b],a.name,{type:a.type,lastModified:Date.now()})):d(a)},a.type,c)},g.src=URL.createObjectURL(a)})}static getFileSizeMB(a){return a.size/1048576}static validateImageFile(a){return["image/jpeg","image/jpg","image/png","image/webp"].includes(a.type)?this.getFileSizeMB(a)>5?{isValid:!1,error:`Arquivo muito grande. M\xe1ximo 5MB.`}:{isValid:!0}:{isValid:!1,error:"Tipo de arquivo n\xe3o suportado. Use JPG, PNG ou WebP."}}static generateUniqueFilename(a,b){let c=Date.now(),d=Math.random().toString(36).substring(2,8),e=a.split(".").pop(),f=a.split(".").slice(0,-1).join(".").toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").trim(),g=b?`${b}-`:"";return`${g}${f}-${c}-${d}.${e}`}static extractPathFromUrl(a){try{let b=new URL(a).pathname.match(/\/o\/(.+)\?/);return b?decodeURIComponent(b[1]):null}catch{return null}}static async cleanupOrphanedImages(a){try{let b=a.map(a=>this.deleteImage(a));await Promise.all(b)}catch(a){throw console.error("Cleanup orphaned images error:",a),Error("Erro ao limpar imagens \xf3rf\xe3s")}}}},97820:(a,b,c)=>{c.d(b,{G:()=>l});var d=c(21124),e=c(38301),f=c(24515),g=c(47089),h=c(71613),i=c(43700),j=c(35284),k=c(3200);function l({onImageUploaded:a,currentImage:b,className:c="",aspectRatio:l="video"}){let[m,n]=(0,e.useState)(!1),[o,p]=(0,e.useState)(0),[q,r]=(0,e.useState)(b||null),s=(0,e.useRef)(null),t=async b=>{let c=k.n.validateImageFile(b);if(!c.isValid)return void alert(c.error);let d=URL.createObjectURL(b);r(d),n(!0),p(0);try{let c=await k.n.uploadBannerImage(b,`temp-${Date.now()}`,a=>{p(a)});a(c),URL.revokeObjectURL(d)}catch(a){console.error("Error uploading image:",a),alert("Erro ao fazer upload da imagem"),r(null)}finally{n(!1),p(0)}};return(0,d.jsxs)("div",{className:`space-y-4 ${c}`,children:[(0,d.jsxs)("div",{className:`
          relative border-2 border-dashed border-gray-300 rounded-lg p-6 text-center
          hover:border-gray-400 transition-colors cursor-pointer
          ${{square:"aspect-square",video:"aspect-video",banner:"aspect-[16/9]"}[l]}
          ${m?"pointer-events-none":""}
        `,onDrop:a=>{a.preventDefault();let b=a.dataTransfer.files[0];b&&b.type.startsWith("image/")&&t(b)},onDragOver:a=>{a.preventDefault()},onClick:()=>s.current?.click(),children:[(0,d.jsx)("input",{ref:s,type:"file",accept:"image/*",onChange:a=>{let b=a.target.files?.[0];b&&t(b)},className:"hidden","aria-label":"Upload de imagem"}),q?(0,d.jsxs)("div",{className:"relative w-full h-full",children:[(0,d.jsx)(f.default,{src:q,alt:"Preview",fill:!0,className:"object-cover rounded-lg",sizes:"(max-width: 768px) 100vw, (max-width: 1024px) 50vw, 33vw"}),m&&(0,d.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center rounded-lg",children:(0,d.jsxs)("div",{className:"text-white text-center",children:[(0,d.jsx)("div",{className:"text-sm mb-2",children:"Fazendo upload..."}),(0,d.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:(0,d.jsx)("div",{className:"progress-bar",style:{"--progress":`${o}%`}})}),(0,d.jsxs)("div",{className:"text-xs mt-1",children:[Math.round(o),"%"]})]})}),!m&&(0,d.jsx)(j.$,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:b=>{try{b.stopPropagation();try{r(null),a(""),s.current&&(s.current.value="")}catch(a){console.warn("Error removing image:",a)}}catch(a){console.warn("Error removing image:",a)}},children:(0,d.jsx)(g.A,{className:"h-4 w-4"})}),!m&&0===o&&q!==b&&(0,d.jsx)("div",{className:"absolute top-2 left-2",children:(0,d.jsx)("div",{className:"bg-green-500 text-white rounded-full p-1",children:(0,d.jsx)(h.A,{className:"h-4 w-4"})})})]}):(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,d.jsx)(i.A,{className:"h-12 w-12 text-gray-400 mb-4"}),(0,d.jsx)("div",{className:"text-lg font-medium text-gray-900 mb-2",children:m?"Fazendo upload...":"Clique ou arraste uma imagem aqui"}),(0,d.jsx)("div",{className:"text-sm text-gray-500",children:"PNG, JPG, WebP at\xe9 5MB"}),m&&(0,d.jsxs)("div",{className:"mt-4 w-full max-w-xs",children:[(0,d.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,d.jsx)("div",{className:"progress-bar",style:{"--progress":`${o}%`}})}),(0,d.jsxs)("div",{className:"text-xs text-gray-600 mt-1 text-center",children:[Math.round(o),"%"]})]})]})]}),q&&!m&&(0,d.jsx)("div",{className:"text-sm text-gray-600 text-center",children:"Imagem carregada com sucesso! Clique para alterar."})]})}}};